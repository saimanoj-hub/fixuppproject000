<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat - fixUP</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h2>fix<span>UP</span></h2>
            </div>
            <div class="nav-links">
                <a href="user-home.html" class="nav-link">Home</a>
                <a href="my-bookings.html" class="nav-link">My Bookings</a>
                <a href="chat-list.html" class="nav-link active">Messages</a>
                <a href="#" class="nav-link" onclick="logout()">Logout</a>
            </div>
        </div>
    </nav>

    <!-- Chat Interface -->
    <div class="chat-container">
        <!-- Sidebar -->
        <div class="chat-sidebar">
            <div class="chat-sidebar-header">
                <h2>Conversations</h2>
                <div class="search-container">
                    <input type="text" id="sidebarSearch" placeholder="üîç Search..." class="search-input">
                </div>
            </div>
            <div class="chat-sidebar-list" id="sidebarConversations">
                <!-- Sidebar conversations will be loaded here -->
            </div>
        </div>

        <!-- Main Chat -->
        <div class="chat-main">
            <!-- Chat Header -->
            <div class="chat-header">
                <img src="" alt="Partner" class="chat-partner-avatar" id="partnerAvatar">
                <div class="chat-partner-info">
                    <h3 id="partnerName">Loading...</h3>
                    <p id="bookingTitle">Service Booking</p>
                    <div class="chat-status">
                        <span id="partnerStatus" class="status-offline">‚óè Offline</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="chat-action-btn" onclick="makeCall()">üìû</button>
                    <button class="chat-action-btn" onclick="viewProfile()">üë§</button>
                    <button class="chat-action-btn" onclick="showOptions()">‚ãØ</button>
                </div>
            </div>

            <!-- Messages Area -->
            <div class="chat-messages" id="chatMessages">
                <div class="message received">
                    <div class="message-text">Hello! Thanks for reaching out about the cabinet repair.</div>
                    <div class="message-time">10:30 AM</div>
                </div>
                
                <div class="message sent">
                    <div class="message-text">Hi! Yes, I have two cabinet doors that need hinge replacement.</div>
                    <div class="message-time">10:32 AM</div>
                    <div class="message-status">‚úì‚úì</div>
                </div>
                
                <div class="typing-indicator" id="typingIndicator" style="display: none;">
                    <span>Mike is typing</span>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            </div>

            <!-- Chat Input -->
            <div class="chat-input-container">
                <form class="chat-input-form" id="chatForm" onsubmit="sendMessage(event)">
                    <button type="button" class="chat-attachment-btn" onclick="attachFile()">üìé</button>
                    <textarea 
                        class="chat-input" 
                        id="messageInput" 
                        placeholder="Type your message..." 
                        rows="1"
                        oninput="autoResize(this)"
                    ></textarea>
                    <button type="submit" class="chat-send-btn" id="sendBtn">‚û§</button>
                </form>
            </div>
        </div>
    </div>

    <script src="../js/chat-script.js"></script>
    <script>
        function logout() {
            localStorage.removeItem('fixUP_user');
            window.location.href = '../index.html';
        }
        
        function makeCall() {
            alert('üìû Starting voice call...');
        }
        
        function viewProfile() {
            const partnerId = document.getElementById('partnerName').getAttribute('data-partner-id');
            window.location.href = `worker-profile.html?id=${partnerId}`;
        }
        
        function showOptions() {
            alert('Chat options menu');
        }
        
        function attachFile() {
            alert('üìé Attachment feature coming soon!');
        }
        
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }
        
        // Check authentication
        document.addEventListener('DOMContentLoaded', function() {
            const user = localStorage.getItem('fixUP_user');
            if (!user) {
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>